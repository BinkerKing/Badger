<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>我的手记列表</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
<link rel="stylesheet" href="{=ctx}/fly/css/layui.css">
<link rel="stylesheet" href="{=ctx}/fly/css/global.css">
</head>
<body>
<div class="layui-row layui-col-space15">
	<div class="layui-col-md8">
		<div id="searchTmplDiv"></div>
		<div id="topListTmplDiv"></div>
		<div id="articleListTmplDiv"></div>
	</div>
	<div class="layui-col-md4">
		<div id="outlineTmplDiv"></div>
		<div class="fly-panel fly-signin">
			<div class="fly-panel-title">
				签到
				<i class="fly-mid"></i> 
				<a href="javascript:;" class="fly-link" id="LAY_signinHelp">说明</a>
				<i class="fly-mid"></i> 
				<a href="javascript:;" class="fly-link" id="LAY_signinTop">活跃榜</a>
			</div>
			<div class="fly-panel-main fly-signin-main">
				<span>可获得<cite>5</cite>飞吻</span>
			</div>
		</div>
	</div>
</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
var form = layui.form, layer = layui.layer;

var AtcList = [];
var lableList=[];//存放该用户所有lable
var search_lable = "";
var search_status = "1";
var authorId = 1;

var outline_unpublish=0;
var outline_publish=0;
var outline_like=0;
var outline_view=0;

var search_value="";
$(function() {
	var url = Const.apiUrl + "/MyAtcController/getMyAtcList"
	var param = {};
	param.authorId = authorId;
	param.status= search_status;
	param.search= null;
	param.lable = null;
	View.post(url, param, function(resp) {
		AtcList = resp;
		var searchData = {};
		searchData.lables = getLables(resp);
		searchData.buttonName = "写文章";
		searchData.buttonFun = "addArticle()"
		//data.article = resp;
		//search模板
		tmplTools.searchTmpl.onload(searchData);
		//topList模板
		var topData = {};
		topData.article = getTopList(resp,3);
		tmplTools.topListTmpl.onload(topData);
		//articleList模板
		var listData = {};
		listData.article = resp;
		tmplTools.articleListTmpl.onload(listData);
		//outline模板
		var outlineData = {};
		outlineData.unpublish = outline_unpublish;
		outlineData.publish = outline_publish;
		outlineData.like = outline_like;
		outlineData.see = outline_view;
		tmplTools.outlineTmpl.onload(outlineData);
		
		View.resetUi();
	}, function() {
		TmplUtils.showMsgFail("出错");
	})
});

function getTopList(resp,count){
	var list = [];
	for(var i=0;i<resp.length;i++){
		if(count == 0)
			return list;
		if(resp[i].starFlag == "1"){
			list.push(resp[i]);
			count --;
		}
	}
}

//写文章
function addArticle(){
	var content = 'articleEdit.html';
	layer.open({
		type : 2,
		title : '写文章',
		skin: 'layui-layer-rim',
		shadeClose : false,
		shade : .3,
		resize  : false,
		area: ['80%', '90%'],
		maxmin : true, //开启最大化最小化按钮
		zIndex: layer.zIndex,
	    success: function(layero){
	        layer.setTop(layero);
	    },
		content : content //iframe的url
	});
}

//查看文章
function viewArticle (id){
	var content = 'myArticleView.html?id='+id;
	layer.open({
		type : 2,
		title : '我的文章',
		skin: 'layui-layer-rim',
		shadeClose : false,
		shade : 0,
		resize  : false,
		area: ['80%', '95%'],
		maxmin: true,
		zIndex: layer.zIndex,
	    success: function(layero){
	        layer.setTop(layero);
	    },
		content : content //iframe的url
	});
}

function getLables(resp){
	var lable = [];
	$.each(resp,function(i,item){
		var lableGroup = item.labelGroup;
		var lables = lableGroup.split(",");
		for ( var i = 0; i <lables.length; i++){
			if(!isInArray(lable,lables[i])){
				var lableObj = {};
				lableObj.name = lables[i];
				lable.push(lableObj);
			}
		}
		if(item.publishStatus == "1"){
			outline_publish ++;
		}else{
			outline_unpublish ++;
		}
		outline_like += item.likeCount;
		outline_view += item.scanCount;
	});
	return lable;
}

function search(status){
	var url = Const.apiUrl + "/MyAtcController/getMyAtcList"
	var param = {};
	param.authorId = authorId;
	if(status != null){
		search_status = status;
	}
	param.status= search_status;
	param.search = "";
	param.lable = search_lable;
	View.post(url, param, function(resp) {
		//articleList模板
		var listData = {};
		listData.article = resp;
		tmplTools.articleListTmpl.onload(listData);
		changeSearchStatus();
		View.resetUi();
	}, function() {
		TmplUtils.showMsgFail("出错");
	})
}

function changeSearchStatus(){
	if(search_status == "1"){
		$("#a1").addClass("active");
		$("#a2").removeClass("active");
		$("#a3").removeClass("active");
		$("#a4").removeClass("active");
	}else if(search_status == "2"){
		$("#a2").addClass("active");
		$("#a1").removeClass("active");
		$("#a3").removeClass("active");
		$("#a4").removeClass("active");
	}else if(search_status == "3"){
		$("#a3").addClass("active");
		$("#a1").removeClass("active");
		$("#a2").removeClass("active");
		$("#a4").removeClass("active");
	}else if(search_status == "4"){
		$("#a4").addClass("active");
		$("#a1").removeClass("active");
		$("#a2").removeClass("active");
		$("#a3").removeClass("active");
	}
}

function isInArray(arr,value){
    for(var i = 0; i < arr.length; i++){
        if(value === arr[i].name){
            return true;
        }
    }
    return false;
}
</script>
<script type="text/javascript" src="/common/tmplsJs/tmplUtils.js"></script>
<link type="include" href="/common/tmpls/searchTmpl.html" />
<link type="include" href="/common/tmpls/topListTmpl.html" />
<link type="include" href="/common/tmpls/articleListTmpl.html" />
<link type="include" href="/common/tmpls/outlineTmpl.html" />
</body>
</html>
</html>