<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>我的手记列表</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
<link rel="stylesheet" href="{=ctx}/block/articleListBlock/layui/css/layui.css">
<link rel="stylesheet" href="{=ctx}/block/articleListBlock/css/demo.css">
</head>
<body class="iframeBody">
<div class="content">
	<div class="layui-row layui-col-space10">
		<div class="layui-col-md8">
			<div class="layui-card" style="height:750px;overflow:auto">
				<div id="articleListDiv"></div>
			</div>
		</div>
		<div class="layui-col-md4">
			<div style="text-align:center;padding-top:6%;">
				<button class="layui-btn layui-btn-lg layui-btn-normal" id ="add-data">
					<i class="iconfont icon-tianjia"></i>写文章
				</button>
			</div>
		    <div class="layui-card" style="height:300px; overflow:auto">
				<div id="outlineDiv"></div>
			</div>
			<div class="layui-card" style="height:300px; overflow:auto">
				
			</div>
		</div>
	</div>
</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	var form = layui.form, layer = layui.layer;
	
	$("#add-data").click(function() {
		var content = 'articleEdit.html';
		layer.open({
			type : 2,
			title : '写文章',
			skin: 'layui-layer-rim',
			shadeClose : true,
			shade : .3,
			resize  : false,
			area: ['80%', '90%'],
			maxmin : true, //开启最大化最小化按钮
			zIndex: layer.zIndex,
		    success: function(layero){
		        layer.setTop(layero);
		    },
			content : content //iframe的url
		});
	});

	var AtcList = [];
	var lableList=[];//存放该用户所有lable
	var search_lable = "";
	var search_status = "1";
	var authorId = 1;
	
	var outline_unpublish=0;
	var outline_publish=0;
	var outline_like=0;
	var outline_view=0;
	
	var search_value= "";
	
	$(function() {
		initArticleTmpl();
	});
	
	function initArticleTmpl(){
		var url = Const.apiUrl + "/MyAtcController/getMyAtcList"
		var param = {};
		param.authorId = authorId;
		param.status= search_status;
		param.search= null;
		param.lable = null;
		View.post(url, param, function(resp) {
			AtcList = resp;
			var data = {};
			data.lables = getLables(resp);
			data.article = resp;
			data.search = search_value;
			var getTpl = articleTmpl.innerHTML;
			var view = $("#articleListDiv")[0];//document.getElementById('articleListDiv');
			layui.laytpl(getTpl).render(data, function(html){
			  view.innerHTML = html;
			});
			initOutlineTmpl();
			changeSearchStatus();
			View.resetUi();
		}, function() {
			TmplUtils.showMsgFail("出错");
		})
	}
	
	function initOutlineTmpl(){
		var data = {};
		data.unpublish = outline_unpublish;
		data.publish = outline_publish;
		data.like = outline_like;
		data.see = outline_view;
		var getTpl = outlineTmpl.innerHTML;
		var view = $("#outlineDiv")[0];
		layui.laytpl(getTpl).render(data, function(html){
		  view.innerHTML = html;
		});
		View.resetUi();
	}
	
	//获取不重复发的标签列表
	function getLables(resp){
		var lable = [];
		$.each(resp,function(i,item){
			var lableGroup = item.labelGroup;
			var lables = lableGroup.split(",");
			for ( var i = 0; i <lables.length; i++){
				if(!isInArray(lable,lables[i])){
					var lableObj = {};
					lableObj.name = lables[i];
					lable.push(lableObj);
				}
			}
			if(item.publishStatus == "1"){
				outline_publish ++;
			}else{
				outline_unpublish ++;
			}
			outline_like += item.likeCount;
			outline_view += item.scanCount;
		});
		return lable;
	}
	
	function AutoTableHeight()
    {
        var dev_obj = document.getElementById('cardDiv'); //table的父div
 
        var layuitable_main = dev_obj.getElementsByClassName("autoHeight");   //在父div中找 layui-table-main 属性所在标签
        if (layuitable_main != null && layuitable_main.length > 0) {
            layuitable_main[0].style.height = '100%';    
        }
 
        var layuitable = dev_obj.getElementsByClassName("layui-form");   //在父div中找 layui-form 属性所在标签
        if (layuitable != null && layuitable.length > 0) {
            layuitable[0].style.height = '100%';
        }
    }
	
	function isInArray(arr,value){
	    for(var i = 0; i < arr.length; i++){
	        if(value === arr[i].name){
	            return true;
	        }
	    }
	    return false;
	}
	
	function publish(id){
		
		
	}
	
	function search(status){
		var url = Const.apiUrl + "/MyAtcController/getMyAtcList"
		var param = {};
		param.authorId = authorId;
		if(status != null){
			search_status = status;
		}
		param.status= search_status;
		param.search= $("#searchInput").val();
		search_value = param.search;
		param.lable = search_lable;
		
		View.post(url, param, function(resp) {
			var data = {};
			data.lables = getLables(resp);
			data.article = resp;
			data.search = search_value;
			var getTpl = articleTmpl.innerHTML;
			var view = $("#articleListDiv")[0];//document.getElementById('articleListDiv');
			layui.laytpl(getTpl).render(data, function(html){
			  view.innerHTML = html;
			});
			changeSearchStatus();
			View.resetUi();
		}, function() {
			TmplUtils.showMsgFail("出错");
		})
	}
	
	function changeSearchStatus(){
		if(search_status == "1"){
			$("#a1").addClass("active");
			$("#a2").removeClass("active");
			$("#a3").removeClass("active");
		}else if(search_status == "2"){
			$("#a1").removeClass("active");
			$("#a2").addClass("active");
			$("#a3").removeClass("active");
		}else{
			$("#a1").removeClass("active");
			$("#a2").removeClass("active");
			$("#a3").addClass("active");
		}
	}
</script>
<script id="outlineTmpl" type="text/html">
<div class="layui-card-header">待办事项</div>
<div class="layui-card-body layui-text">
	<table class="layui-table">
		<colgroup>
		  <col width="200">
		  <col>
		</colgroup>
		<tbody>
		  <tr>
			<td>未发布文章数</td>
			<td><p>{{d.unpublish}}</p></td>
		  </tr>
		  <tr>
			<td>发布文章数</td>
			<td><p>{{d.publish}}</p></td>
		  </tr>
		  <tr>
			<td>点赞量</td>
			<td>{{d.like}}</td>
		  </tr>
		  <tr>
			<td>浏览量</td>
			<td><p>{{d.see}}</p></td>
		  </tr>
		</tbody>
	</table>
</div>
</script>
<script id="articleTmpl" type="text/html">
<div class="sub-header" id="sub-nav">
	<div class="label-manage">
		<div class="my-label">
			<div class="label-box">
				<ul>
					<li>我的关注:</li>
					{{#
						layui.each(d.lables, function(index, item){
					}}
					<li><a href="/wenda/5" target="_blank">{{item.name}}</a></li>
					{{#
						});
					}}
				</ul>
			</div>
		</div>
		<div class="add-label js-label-manage">
			标签管理
		</div>
	</div>
</div>

<div class="mainContent">
	<div class="wrapper">
		<div class="wdnav clearfix">
			<div class="nav-list fl">
				<a id="a1" href="javascript:search('1');" class="active">全部</a>
				<a id="a2" href="javascript:search('2');">已发布</a>
				<a id="a3" href="javascript:search('3');">未发布</a>
			</div>
			<div class="que-btn clearfix fr">
				<button class="layui-btn layui-btn-normal layui-btn layui-btn-sm" onclick="search()">搜索</button>
			</div>
			<div class="search-warp clearfix">
				<div class="search-area" data-search="top-banner">
					<input id="searchInput" class="search-input" data-suggest-trigger="suggest-trigger" placeholder="{{d.search}}" type="text" autocomplete="off">
					<input type="hidden" class="btn_search" data-search-btn="search-btn">
					<ul class="search-area-result" data-suggest-result="suggest-result" style="display: none;"></ul>
				</div>
				<div class="showhide-search" data-show="no">
					<i class="layui-icon">&#xe615;</i>
				</div>
			</div>
		</div>
		<div class="ques-list">
			{{#
				layui.each(d.article, function(index, item){
			}}
			<div class="item clearfix">
				<div class="item-num fl">
					{{#
						if(item.publishStatus == "0"){
					}}
					<button class="layui-btn layui-btn-normal layui-btn-lg" onclick="publish({{item.id}})">发布</button>
					{{#
						}else{
					}}
					<a href="javascript:;" class="has-finish" target="_blank">
						<em>{{item.likeCount}}</em>
						<span>点赞</span>
					</a>
					<a href="javascript:;" target="_blank">
						<em>{{item.scanCount}}</em>
						<span>浏览</span>
					</a>
					{{#
						}
					}}
				</div>
				<div class="que-con">
					<a href="javascript:;" class="que-title" target="_blank" title="{{item.titleInfo}}">{{item.titleInfo}}</a>
					<div class="label">
						<img src="//img.mukewang.com/59e9700900012e3602400240.jpg" title="JAVA">
						<a href="javascript:;" target="_blank">{{item.labelGroup}}</a>
					</div>
				</div>
			</div>
			{{#
				});
			}}
		</div>
	</div>
</div>
</script>
</body>
</html>
</html>