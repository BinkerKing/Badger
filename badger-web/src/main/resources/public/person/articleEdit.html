<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>我的手记列表</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
<link type="include" href="/common/simditor.html" />
</head>
<body class="iframeBody">
<div class="layui-row layui-col-space15">
	<div class="layui-col-md10 layui-col-md-offset1">
		<input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题"  class="layui-input">
		<textarea id="editor" placeholder="" autofocus required></textarea>
	</div>
	<div class="layui-col-md1">
		<ul class="layui-fixbar">
			<li class="layui-icon" lay-type="bar1" style="background-color:none" onclick="saveSet()"></li>
			<li class="layui-icon" lay-type="bar1" style="background-color:none" onclick="getTemplet()"></li>
		</ul>
	</div>
</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	/*全局定义*/
	var form = layui.form, layer = layui.layer;
	var id = View.getQStr("id");
	var TAtcInfomation = {};
	$(function() {
		//editor.setValue();
		if(id){
			var url = Const.apiUrl + "/MyAtcController/getContent";
			View.get(url,"id="+id,function(resp){
				TAtcInfomation = resp;
				loadView(resp);
			},function(){
				TmplUtils.showMsgFail("打开文件出错");
			})
		}else{
			TAtcInfomation.starFlag="0";
			TAtcInfomation.topFlag="0";
			TAtcInfomation.labelGroup="";
			TAtcInfomation.publishStatus="0";
			
		}
	});
	
	/*富文本框定义-开始*/
	var toolbar = ['title','bold','italic','underline','strikethrough','fontScale','color','ol','ul','blockquote',
		  'code','table','link','image','hr','indent','outdent','alignment'];
	
	var editor = new Simditor({
		  textarea: $('#editor'),
		  placeholder: ' ', //占位符
		  params: {},
		  upload: true,
		  tabIndent: true,
		  toolbar: toolbar,
		  pasteImage: true,
		  allowerTags: null,
		  cleanPaste: true,
		  upload : {
            url : Const.apiUrl + "/TCustInfoController/savePic", //文件上传的接口地址
            params: null, //键值对,指定文件上传接口的额外参数,上传的时候随文件一起提交
            fileKey: 'upload_file', //服务器端获取文件数据的参数名
            connectionCount: 3,
            leaveConfirm: '正在上传文件'
        }
	});
	
	function getValue(){
		var value = editor.getValue();
		console.log(value);
	}
	/*富文本框定义-结束*/
	
	/*数据操作-开始*/
	//准备数据
	function prepareData(operateType){
		var tAtcInfomation = {};
		if(TAtcInfomation!=null)
			tAtcInfomation = TAtcInfomation;
		tAtcInfomation.titleInfo = $("input[name='title']").val();
		tAtcInfomation.tatcContent = {};
		tAtcInfomation.tatcContent.titleInfo = $("input[name='title']").val();
		tAtcInfomation.tatcContent.htmlContent = $("#editor").val();
		switch (operateType) {
		case "save":
			tAtcInfomation.publishStatus = "0";//未发布
			break;
		case "publish":
			tAtcInfomation.publishStatus = "1";//已发布
			break;
		default:
			break;
		}
		return tAtcInfomation;
	}
	//校验数据
	function checkData(data){
		//新建保存前的校验
		return "";
	}
	//保存操作
	function save(){
		var editWait = layer.load();
		var tAtcInfomation = prepareData();//数据准备
		var logInfo = checkData(tAtcInfomation);//校验
		if (logInfo != "") {
			TmplUtils.showMsgFail(logInfo);
			return;
		}
		if(id){
			//修改
			
		}else{
			//新增
			var url = Const.apiUrl +"/MyAtcController/saveAtc";
			View.post(url,tAtcInfomation,function(){
				layer.close(editWait);
				TmplUtils.showMsgSuccess("保存成功");
				back();
			},function(){
				TmplUtils.showMsgFail("保存出错");
			})
		}
	}
	//保存配置
	function saveSet(){
		var content = 'atcProperty.html';
		layer.open({
			type : 2,
			title : '编辑文章属性',
			skin: 'layui-layer-rim',
			shadeClose : false,
			shade : .3,
			resize  : false,
			area: ['40%', '80%'],
			maxmin : false, //开启最大化最小化按钮
			zIndex: layer.zIndex,
		    success: function(layero){
		        layer.setTop(layero);
		    },
			content : content //iframe的url
		});
	}
	
	function getTemplet(){
		var content = 'atcTemplet.html';
		layer.open({
			type : 2,
			title : '选择模板',
			skin: 'layui-layer-rim',
			shadeClose : false,
			shade : .3,
			resize  : false,
			area: ['40%', '80%'],
			maxmin : false, //开启最大化最小化按钮
			zIndex: layer.zIndex,
		    success: function(layero){
		        layer.setTop(layero);
		    },
			content : content //iframe的url
		});
	}
	/*数据操作-结束*/
	/*页面控制-开始*/
	//渲染页面
	function loadView(){
		$("input[name='title']").val(TAtcInfomation.titleInfo);
		$("#editor").val(TAtcInfomation.tatcContent.htmlContent);
		View.resetUi();
	}
	//返回操作
	function back() {
		parent.View.fireEvent("TB_DATA_CHANGE", {
			"window" : window.name
		});
	}
	View.setEvent("TB_DATA_CHANGE", function(arg) {
	    if (!!arg && arg.window) {
	        var index = layer.getFrameIndex(arg.window); //获取窗口索引
	        layer.close(index);
	    }
	    $("input[name='title']").val(TAtcInfomation.titleInfo)
    	View.resetUi();
	});
	function getInfoById(){
		
	}
	/*页面控制-结束*/
</script>
</html>